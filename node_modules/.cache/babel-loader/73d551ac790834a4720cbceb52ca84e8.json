{"ast":null,"code":"import _toConsumableArray from \"/Users/jasonflax/Development/ChatApp/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _regeneratorRuntime from \"/Users/jasonflax/Development/ChatApp/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/jasonflax/Development/ChatApp/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _possibleConstructorReturn from \"/Users/jasonflax/Development/ChatApp/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/jasonflax/Development/ChatApp/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/jasonflax/Development/ChatApp/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _classCallCheck from \"/Users/jasonflax/Development/ChatApp/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/jasonflax/Development/ChatApp/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport { usersCollection } from \".\";\n/**\n * The customer user object relative to our Stitch user that contains\n * extended profile information.\n * \n * @param id {String}\n * @param name {String}\n * @param defaultAvatarOrdinal {Number} 0-7\n * @param avatar {ByteArray}\n * @param channelsSubscribedTo {StringArray}\n */\n\nexport function User(_id, name, defaultAvatarOrdinal, avatar, channelsSubscribedTo) {\n  return {\n    _id: _id,\n    name: name,\n    defaultAvatarOrdinal: defaultAvatarOrdinal,\n    avatar: avatar,\n    channelsSubscribedTo: channelsSubscribedTo\n  };\n} // define a class\n\nexport var Observable =\n/*#__PURE__*/\nfunction () {\n  // each instance of the Observer class\n  // starts with an empty array of things (observers)\n  // that react to a state change\n  function Observable() {\n    _classCallCheck(this, Observable);\n\n    this.observers = [];\n  } // add the ability to subscribe to a new object / DOM element\n  // essentially, add something to the observers array\n\n\n  _createClass(Observable, [{\n    key: \"subscribe\",\n    value: function subscribe(f) {\n      this.observers.push(f);\n    } // add the ability to unsubscribe from a particular object\n    // essentially, remove something from the observers array\n\n  }, {\n    key: \"unsubscribe\",\n    value: function unsubscribe(f) {\n      this.observers = this.observers.filter(function (subscriber) {\n        return subscriber !== f;\n      });\n    } // update all subscribed objects / DOM elements\n    // and pass some data to each of them\n\n  }, {\n    key: \"notify\",\n    value: function notify(data) {\n      this.observers.forEach(function (observer) {\n        return observer(data);\n      });\n    }\n  }]);\n\n  return Observable;\n}();\nexport var UserObserver =\n/*#__PURE__*/\nfunction (_Observable) {\n  _inherits(UserObserver, _Observable);\n\n  function UserObserver() {\n    _classCallCheck(this, UserObserver);\n\n    return _possibleConstructorReturn(this, _getPrototypeOf(UserObserver).call(this));\n  }\n\n  _createClass(UserObserver, [{\n    key: \"configure\",\n    value: function () {\n      var _configure = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee() {\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.next = 2;\n                return usersCollection.watch(localStorage.getItem(\"user_ids\"));\n\n              case 2:\n                this.stream = _context.sent;\n                this.stream.onNext(this.notify);\n\n              case 4:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function configure() {\n        return _configure.apply(this, arguments);\n      }\n\n      return configure;\n    }()\n  }, {\n    key: \"sync\",\n    value: function () {\n      var _sync = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee2(ids) {\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                this.stream.close();\n                _context2.next = 3;\n                return usersCollection.find({\n                  _id: {\n                    $in: ids\n                  }\n                }).asArray;\n\n              case 3:\n                _context2.t0 = function (user) {\n                  localStorage.setItem(\"users:\" + user._id, user);\n                  var idsList = localStorage.getItem(\"user_ids\");\n                  idsList.push.apply(idsList, _toConsumableArray(ids));\n                  localStorage.setItem(\"user_ids\", idsList);\n                };\n\n                _context2.sent.forEach(_context2.t0);\n\n                _context2.next = 7;\n                return usersCollection.watch(localStorage.getItem(\"user_ids\"));\n\n              case 7:\n                this.stream = _context2.sent;\n                this.stream.onNext(this.notify);\n\n              case 9:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      function sync(_x) {\n        return _sync.apply(this, arguments);\n      }\n\n      return sync;\n    }()\n  }]);\n\n  return UserObserver;\n}(Observable);\nexport var usersObserver = UserObserver();\nexport function ChannelSubscription(_id, channelId, ownerId, deviceId, localTimestamp, remoteTimestamp) {\n  return {\n    _id: _id,\n    channelId: channelId,\n    ownerId: ownerId,\n    deviceId: deviceId,\n    localTimestamp: localTimestamp,\n    remoteTimestamp: remoteTimestamp\n  };\n}\nexport var ChannelSubscriptionObserver =\n/*#__PURE__*/\nfunction (_Observable2) {\n  _inherits(ChannelSubscriptionObserver, _Observable2);\n\n  function ChannelSubscriptionObserver() {\n    _classCallCheck(this, ChannelSubscriptionObserver);\n\n    return _possibleConstructorReturn(this, _getPrototypeOf(ChannelSubscriptionObserver).call(this));\n  }\n\n  _createClass(ChannelSubscriptionObserver, [{\n    key: \"configure\",\n    value: function () {\n      var _configure2 = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee3() {\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                _context3.next = 2;\n                return usersCollection.watch(localStorage.getItem(\"user_ids\"));\n\n              case 2:\n                this.stream = _context3.sent;\n                this.stream.onNext(this.notify);\n\n              case 4:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this);\n      }));\n\n      function configure() {\n        return _configure2.apply(this, arguments);\n      }\n\n      return configure;\n    }()\n  }, {\n    key: \"sync\",\n    value: function () {\n      var _sync2 = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee4(ids) {\n        return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                this.stream.close();\n                _context4.next = 3;\n                return usersCollection.find({\n                  _id: {\n                    $in: ids\n                  }\n                }).asArray;\n\n              case 3:\n                _context4.t0 = function (user) {\n                  localStorage.setItem(\"users:\" + user._id, user);\n                  var idsList = localStorage.getItem(\"user_ids\");\n                  idsList.push.apply(idsList, _toConsumableArray(ids));\n                  localStorage.setItem(\"user_ids\", idsList);\n                };\n\n                _context4.sent.forEach(_context4.t0);\n\n                _context4.next = 7;\n                return usersCollection.watch(localStorage.getItem(\"user_ids\"));\n\n              case 7:\n                this.stream = _context4.sent;\n                this.stream.onNext(this.notify);\n\n              case 9:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4, this);\n      }));\n\n      function sync(_x2) {\n        return _sync2.apply(this, arguments);\n      }\n\n      return sync;\n    }()\n  }]);\n\n  return ChannelSubscriptionObserver;\n}(Observable);","map":{"version":3,"sources":["/Users/jasonflax/Development/ChatApp/src/models.js"],"names":["usersCollection","User","_id","name","defaultAvatarOrdinal","avatar","channelsSubscribedTo","Observable","observers","f","push","filter","subscriber","data","forEach","observer","UserObserver","watch","localStorage","getItem","stream","onNext","notify","ids","close","find","$in","asArray","user","setItem","idsList","usersObserver","ChannelSubscription","channelId","ownerId","deviceId","localTimestamp","remoteTimestamp","ChannelSubscriptionObserver"],"mappings":"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","sourcesContent":["import { usersCollection } from \".\";\n\n/**\n * The customer user object relative to our Stitch user that contains\n * extended profile information.\n * \n * @param id {String}\n * @param name {String}\n * @param defaultAvatarOrdinal {Number} 0-7\n * @param avatar {ByteArray}\n * @param channelsSubscribedTo {StringArray}\n */\nexport function User(_id, name, defaultAvatarOrdinal, avatar, channelsSubscribedTo) {\n\treturn {\n\t\t_id, name, defaultAvatarOrdinal, avatar, channelsSubscribedTo\n\t};\n}\n\n// define a class\nexport class Observable {\n\t// each instance of the Observer class\n\t// starts with an empty array of things (observers)\n\t// that react to a state change\n\tconstructor() {\n\t  this.observers = [];\n\t}\n  \n\t// add the ability to subscribe to a new object / DOM element\n\t// essentially, add something to the observers array\n\tsubscribe(f) {\n\t  this.observers.push(f);\n\t}\n  \n\t// add the ability to unsubscribe from a particular object\n\t// essentially, remove something from the observers array\n\tunsubscribe(f) {\n\t  this.observers = this.observers.filter(subscriber => subscriber !== f);\n\t}\n  \n\t// update all subscribed objects / DOM elements\n\t// and pass some data to each of them\n\tnotify(data) {\n\t  this.observers.forEach(observer => observer(data));\n\t}\n  }\n\nexport class UserObserver extends Observable {\n\tconstructor() {\n\t\tsuper();\n\t}\n\n\tasync configure() {\n\t\tthis.stream = await usersCollection.watch(localStorage.getItem(\"user_ids\"));\n\t\tthis.stream.onNext(this.notify);\n\t}\n\n\tasync sync(ids) {\n\t\tthis.stream.close();\n\t\t(await usersCollection.find({_id: { $in: ids }}).asArray).forEach((user) => {\n\t\t\tlocalStorage.setItem(\"users:\" + user._id, user);\n\t\t\tconst idsList = localStorage.getItem(\"user_ids\");\n\t\t\tidsList.push(...ids);\n\t\t\tlocalStorage.setItem(\"user_ids\", idsList);\n\t\t});\n\t\tthis.stream = await usersCollection.watch(localStorage.getItem(\"user_ids\"));\n\t\tthis.stream.onNext(this.notify);\n\t}\n}\n\nexport const usersObserver = UserObserver();\n\nexport function ChannelSubscription(_id, channelId, ownerId, deviceId, localTimestamp, remoteTimestamp) {\n\treturn {\n\t\t_id, channelId, ownerId, deviceId, localTimestamp, remoteTimestamp \n\t};\n}\n\nexport class ChannelSubscriptionObserver extends Observable {\n\tconstructor() {\n\t\tsuper();\n\t}\n\n\tasync configure() {\n\t\tthis.stream = await usersCollection.watch(localStorage.getItem(\"user_ids\"));\n\t\tthis.stream.onNext(this.notify);\n\t}\n\n\tasync sync(ids) {\n\t\tthis.stream.close();\n\t\t(await usersCollection.find({_id: { $in: ids }}).asArray).forEach((user) => {\n\t\t\tlocalStorage.setItem(\"users:\" + user._id, user);\n\t\t\tconst idsList = localStorage.getItem(\"user_ids\");\n\t\t\tidsList.push(...ids);\n\t\t\tlocalStorage.setItem(\"user_ids\", idsList);\n\t\t});\n\t\tthis.stream = await usersCollection.watch(localStorage.getItem(\"user_ids\"));\n\t\tthis.stream.onNext(this.notify);\n\t}\n}"]},"metadata":{},"sourceType":"module"}