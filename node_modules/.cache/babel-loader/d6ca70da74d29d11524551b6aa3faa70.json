{"ast":null,"code":"import _toConsumableArray from \"/Users/jasonflax/Development/ChatApp/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _regeneratorRuntime from \"/Users/jasonflax/Development/ChatApp/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/jasonflax/Development/ChatApp/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"/Users/jasonflax/Development/ChatApp/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/jasonflax/Development/ChatApp/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport { usersCollection } from \".\";\n/**\n * The customer user object relative to our Stitch user that contains\n * extended profile information.\n * \n * @param id {String}\n * @param name {String}\n * @param defaultAvatarOrdinal {Number} 0-7\n * @param avatar {ByteArray}\n * @param channelsSubscribedTo {StringArray}\n */\n\nexport function User(_id, name, defaultAvatarOrdinal, avatar, channelsSubscribedTo) {\n  return {\n    _id: _id,\n    name: name,\n    defaultAvatarOrdinal: defaultAvatarOrdinal,\n    avatar: avatar,\n    channelsSubscribedTo: channelsSubscribedTo\n  };\n}\n\nvar UserObserver =\n/*#__PURE__*/\nfunction () {\n  function UserObserver() {\n    _classCallCheck(this, UserObserver);\n  }\n\n  _createClass(UserObserver, [{\n    key: \"onEvent\",\n    value: function onEvent(changeEvent) {}\n  }, {\n    key: \"configure\",\n    value: function () {\n      var _configure = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee() {\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.next = 2;\n                return usersCollection.watch();\n\n              case 2:\n                this.stream = _context.sent;\n                this.stream.onNext(this.onEvent);\n\n              case 4:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function configure() {\n        return _configure.apply(this, arguments);\n      }\n\n      return configure;\n    }()\n  }, {\n    key: \"sync\",\n    value: function () {\n      var _sync = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee2(ids) {\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                this.stream.close();\n                _context2.next = 3;\n                return usersCollection.find({\n                  _id: {\n                    $in: ids\n                  }\n                }).asArray;\n\n              case 3:\n                _context2.t0 = function (user) {\n                  localStorage.setItem(\"users:\" + user._id, user);\n                  var idsList = localStorage.getItem(\"user_ids\");\n                  idsList.push.apply(idsList, _toConsumableArray(ids));\n                  localStorage.setItem(\"user_ids\", idsList);\n                };\n\n                _context2.sent.forEach(_context2.t0);\n\n                _context2.next = 7;\n                return usersCollection.watch(localStorage.getItem(\"user_ids\"));\n\n              case 7:\n                this.stream = _context2.sent;\n                this.stream.onNext(this.onEvent);\n\n              case 9:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      function sync(_x) {\n        return _sync.apply(this, arguments);\n      }\n\n      return sync;\n    }()\n  }]);\n\n  return UserObserver;\n}();\n\nexport function ChannelSubscription(_id, channelId, ownerId, deviceId, localTimestamp, remoteTimestamp) {\n  return {\n    _id: _id,\n    channelId: channelId,\n    ownerId: ownerId,\n    deviceId: deviceId,\n    localTimestamp: localTimestamp,\n    remoteTimestamp: remoteTimestamp\n  };\n}","map":{"version":3,"sources":["/Users/jasonflax/Development/ChatApp/src/models.js"],"names":["usersCollection","User","_id","name","defaultAvatarOrdinal","avatar","channelsSubscribedTo","UserObserver","changeEvent","watch","stream","onNext","onEvent","ids","close","find","$in","asArray","user","localStorage","setItem","idsList","getItem","push","forEach","ChannelSubscription","channelId","ownerId","deviceId","localTimestamp","remoteTimestamp"],"mappings":";;;;;AAAA,SAASA,eAAT,QAAgC,GAAhC;AAEA;;;;;;;;;;;AAUA,OAAO,SAASC,IAAT,CAAcC,GAAd,EAAmBC,IAAnB,EAAyBC,oBAAzB,EAA+CC,MAA/C,EAAuDC,oBAAvD,EAA6E;AACnF,SAAO;AACNJ,IAAAA,GAAG,EAAHA,GADM;AACDC,IAAAA,IAAI,EAAJA,IADC;AACKC,IAAAA,oBAAoB,EAApBA,oBADL;AAC2BC,IAAAA,MAAM,EAANA,MAD3B;AACmCC,IAAAA,oBAAoB,EAApBA;AADnC,GAAP;AAGA;;IAEKC,Y;;;;;;;;;4BACGC,W,EAAa,CAEpB;;;;;;;;;;;;uBAGoBR,eAAe,CAACS,KAAhB,E;;;AAApB,qBAAKC,M;AACL,qBAAKA,MAAL,CAAYC,MAAZ,CAAmB,KAAKC,OAAxB;;;;;;;;;;;;;;;;;;;;;iDAGUC,G;;;;;AACV,qBAAKH,MAAL,CAAYI,KAAZ;;uBACOd,eAAe,CAACe,IAAhB,CAAqB;AAACb,kBAAAA,GAAG,EAAE;AAAEc,oBAAAA,GAAG,EAAEH;AAAP;AAAN,iBAArB,EAA0CI,O;;;+BAAiB,UAACC,IAAD,EAAU;AAC3EC,kBAAAA,YAAY,CAACC,OAAb,CAAqB,WAAWF,IAAI,CAAChB,GAArC,EAA0CgB,IAA1C;AACA,sBAAMG,OAAO,GAAGF,YAAY,CAACG,OAAb,CAAqB,UAArB,CAAhB;AACAD,kBAAAA,OAAO,CAACE,IAAR,OAAAF,OAAO,qBAASR,GAAT,EAAP;AACAM,kBAAAA,YAAY,CAACC,OAAb,CAAqB,UAArB,EAAiCC,OAAjC;AACA,iB;;+BALyDG,O;;;uBAMtCxB,eAAe,CAACS,KAAhB,CAAsBU,YAAY,CAACG,OAAb,CAAqB,UAArB,CAAtB,C;;;AAApB,qBAAKZ,M;AACL,qBAAKA,MAAL,CAAYC,MAAZ,CAAmB,KAAKC,OAAxB;;;;;;;;;;;;;;;;;;;;;AAIF,OAAO,SAASa,mBAAT,CAA6BvB,GAA7B,EAAkCwB,SAAlC,EAA6CC,OAA7C,EAAsDC,QAAtD,EAAgEC,cAAhE,EAAgFC,eAAhF,EAAiG;AACvG,SAAO;AACN5B,IAAAA,GAAG,EAAHA,GADM;AACDwB,IAAAA,SAAS,EAATA,SADC;AACUC,IAAAA,OAAO,EAAPA,OADV;AACmBC,IAAAA,QAAQ,EAARA,QADnB;AAC6BC,IAAAA,cAAc,EAAdA,cAD7B;AAC6CC,IAAAA,eAAe,EAAfA;AAD7C,GAAP;AAGA","sourcesContent":["import { usersCollection } from \".\";\n\n/**\n * The customer user object relative to our Stitch user that contains\n * extended profile information.\n * \n * @param id {String}\n * @param name {String}\n * @param defaultAvatarOrdinal {Number} 0-7\n * @param avatar {ByteArray}\n * @param channelsSubscribedTo {StringArray}\n */\nexport function User(_id, name, defaultAvatarOrdinal, avatar, channelsSubscribedTo) {\n\treturn {\n\t\t_id, name, defaultAvatarOrdinal, avatar, channelsSubscribedTo\n\t};\n}\n\nclass UserObserver {\n\tonEvent(changeEvent) {\n\n\t}\n\n\tasync configure() {\n\t\tthis.stream = await usersCollection.watch()\n\t\tthis.stream.onNext(this.onEvent);\n\t}\n\n\tasync sync(ids) {\n\t\tthis.stream.close();\n\t\t(await usersCollection.find({_id: { $in: ids }}).asArray).forEach((user) => {\n\t\t\tlocalStorage.setItem(\"users:\" + user._id, user);\n\t\t\tconst idsList = localStorage.getItem(\"user_ids\");\n\t\t\tidsList.push(...ids);\n\t\t\tlocalStorage.setItem(\"user_ids\", idsList);\n\t\t});\n\t\tthis.stream = await usersCollection.watch(localStorage.getItem(\"user_ids\"));\n\t\tthis.stream.onNext(this.onEvent);\n\t}\n}\n\nexport function ChannelSubscription(_id, channelId, ownerId, deviceId, localTimestamp, remoteTimestamp) {\n\treturn {\n\t\t_id, channelId, ownerId, deviceId, localTimestamp, remoteTimestamp \n\t};\n}\n"]},"metadata":{},"sourceType":"module"}